<div class="paragraph">
<p>You know, sometimes our first feelings let us down because the world around us is not so simple. I was going to stop with <a href="https://valor-software.com/articles/google-translate-customization-under-nextjs" target="_blank" rel="noopener">Google Translate customization under NextJS</a>. This article reveals an approach to translate any content freely without pain via Google Translate on a NextJS-based project. But a couple of occasions became a game changer.</p>
</div>
<div class="paragraph">
<p>First, I found one essential improvement regarding language configuration. Second, my colleague <a href="https://github.com/brunos3d" target="_blank" rel="noopener">Bruno Silva</a> provided me with valuable code improvements. I decided to make a new series by analyzing the factors above. I recommend reading <a href="https://valor-software.com/articles/google-translate-customization-under-nextjs" target="_blank" rel="noopener">the previous series</a> if you want to understand my following thoughts.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s get started.</p>
</div>
<div class="paragraph">
<p>The central part of the previous solution is <a href="https://github.com/buchslava/nextjs-gtrans-demo/blob/main/public/assets/scripts/lang-config.js" target="_blank" rel="noopener">public/assets/scripts/lang-config.js</a> contains custom languages settings</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-code" data-lang="code">window.__GOOGLE_TRANSLATION_CONFIG__ = {
  languages: [
    { title: "English", name: "en" },
    { title: "Deutsch", name: "de" },
    { title: "Español", name: "es" },
    { title: "Français", name: "fr" },
  ],
  defaultLanguage: "en",
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>The solution above is legal, but it doesn&#8217;t look like a NextJS-pure. I found a more elegant way to define global data through NextJS config. Let&#8217;s add <mark>env</mark> section to <a href="https://github.com/buchslava/nextjs-gtrans-demo/blob/improved/next.config.js" target="_blank" rel="noopener">next.config.js</a> and remove <mark>public/assets/scripts/lang-config.js</mark></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-code" data-lang="code">/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  env: {
    GOOGLE_TRANSLATION_CONFIG: JSON.stringify({
      languages: [
        { title: "English", name: "en" },
        { title: "Deutsch", name: "de" },
        { title: "Español", name: "es" },
        { title: "Français", name: "fr" },
      ],
      defaultLanguage: "en",
    }),
  },
};

module.exports = nextConfig;</code></pre>
</div>
</div>
<div class="paragraph">
<p>I also changed <a href="https://github.com/buchslava/nextjs-gtrans-demo/blob/main/public/assets/scripts/translation.js" target="_blank" rel="noopener">public/assets/scripts/translation.js</a> the following way because <mark>pageLanguage</mark> parameter is not mandatory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-code" data-lang="code">function TranslateInit() {
  new google.translate.TranslateElement();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>According to Bruno&#8217;s proposal, I encapsulated most of the logic into a custom hook, <a href="https://github.com/buchslava/nextjs-gtrans-demo/blob/improved/src/hooks/useLanguageSwitcher.ts" target="_blank" rel="noopener">src/hooks/useLanguageSwitcher.ts</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-code" data-lang="code">import { useEffect, useState } from "react";
import { parseCookies, setCookie } from "nookies";
import { NextPageContext } from "next";

export const COOKIE_NAME = "googtrans";

export interface LanguageDescriptor {
  name: string;
  title: string;
}

export interface LanguageConfig {
  languages: LanguageDescriptor[];
  defaultLanguage: string;
}

export type UseLanguageSwitcherResult = {
  currentLanguage: string;
  switchLanguage: (lang: string) =&gt; () =&gt; void;
  languageConfig: LanguageConfig | undefined;
};

export type UseLanguageSwitcherOptions = {
  context?: NextPageContext;
};

export const getLanguageConfig = (): LanguageConfig | undefined =&gt; {
  let cfg: LanguageConfig | undefined;

  if (process.env.GOOGLE_TRANSLATION_CONFIG) {
    try {
      cfg = JSON.parse(process.env.GOOGLE_TRANSLATION_CONFIG ?? "{}");
    } catch (e) {}
  }

  return cfg;
};

export const useLanguageSwitcher = ({
  context,
}: UseLanguageSwitcherOptions = {}): UseLanguageSwitcherResult =&gt; {
  const [currentLanguage, setCurrentLanguage] = useState&lt;string&gt;("");

  useEffect(() =&gt; {
    const cfg = getLanguageConfig();
    const cookies = parseCookies(context);
    const existingLanguageCookieValue = cookies[COOKIE_NAME];

    let languageValue = "";
    if (existingLanguageCookieValue) {
      const sp = existingLanguageCookieValue.split("/");
      if (sp.length &gt; 2) {
        languageValue = sp[2];
      }
    }
    if (cfg &amp;&amp; !languageValue) {
      languageValue = cfg.defaultLanguage;
    }
    setCurrentLanguage(languageValue);
  }, []);

  const switchLanguage = (lang: string) =&gt; () =&gt; {
    setCookie(context, COOKIE_NAME, "/auto/" + lang);
    window.location.reload();
  };

  return {
    currentLanguage,
    switchLanguage,
    languageConfig: getLanguageConfig(),
  };
};

export default useLanguageSwitcher;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Important note.</strong> <mark>process.env.GOOGLE_TRANSLATION_CONFIG</mark> allows us to get <mark>GOOGLE_TRANSLATION_CONFIG</mark> variable from the above mentioned NextJS config.</p>
</div>
<div class="paragraph">
<p>A couple of final stitches.</p>
</div>
<div class="sect3">
<h4 id="_srccomponentslang_switcher_tsx"><a href="https://github.com/buchslava/nextjs-gtrans-demo/blob/improved/src/components/lang-switcher.tsx" target="_blank" rel="noopener">src/components/lang-switcher.tsx</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-code" data-lang="code">import { NextPageContext } from "next";
import useLanguageSwitcher, {
  LanguageDescriptor,
} from "@/hooks/useLanguageSwitcher";
import React from "react";

export type LanguageSwitcherProps = {
  context?: NextPageContext;
};

export const LanguageSwitcher = ({ context }: LanguageSwitcherProps = {}) =&gt; {
  const { currentLanguage, switchLanguage, languageConfig } =
    useLanguageSwitcher({ context });

  if (!languageConfig) {
    return null;
  }

  return (
    &lt;div className="text-center notranslate"&gt;
      {languageConfig.languages.map((ld: LanguageDescriptor, i: number) =&gt; (
        &lt;React.Fragment key={`l_s_${ld}`}&gt;
          {currentLanguage === ld.name ||
          (currentLanguage === "auto" &amp;&amp;
            languageConfig.defaultLanguage === ld.name) ? (
            &lt;span className="mx-3 text-orange-300"&gt;{ld.title}&lt;/span&gt;
          ) : (
            &lt;a
              onClick={switchLanguage(ld.name)}
              className="mx-3 text-blue-300 cursor-pointer hover:underline"
            &gt;
              {ld.title}
            &lt;/a&gt;
          )}
        &lt;/React.Fragment&gt;
      ))}
    &lt;/div&gt;
  );
};

export default LanguageSwitcher;</code></pre>
</div>
</div>
<div class="paragraph">
<p><mark>useLanguageSwitcher</mark> looks elegant :)</p>
</div>
</div>
<div class="sect3">
<h4 id="_srcpages_document_tsx"><a href="https://github.com/buchslava/nextjs-gtrans-demo/blob/improved/src/pages/_document.tsx" target="_blank" rel="noopener">src/pages/_document.tsx</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-code" data-lang="code">import { Html, Head, Main, NextScript } from "next/document";
import Script from "next/script";

export default function Document() {
  return (
    &lt;Html&gt;
      &lt;Head&gt;
        &lt;Script
          src="/assets/scripts/translation.js"
          strategy="beforeInteractive"
        /&gt;
        {process.env.GOOGLE_TRANSLATION_CONFIG &amp;&amp; (
          &lt;Script
            src="//translate.google.com/translate_a/element.js?cb=TranslateInit"
            strategy="afterInteractive"
          /&gt;
        )}
      &lt;/Head&gt;
      &lt;body&gt;
        &lt;Main /&gt;
        &lt;NextScript /&gt;
      &lt;/body&gt;
    &lt;/Html&gt;
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We don&#8217;t even physically include the translation engine if the config is missing.</p>
</div>
<div class="paragraph">
<p>You can find the final solution <a href="https://github.com/buchslava/nextjs-gtrans-demo/tree/improved" target="_blank" rel="noopener">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_may_the_google_translate_nextjs_and_force_be_with_you">May the Google Translate, NextJS, and Force be with you!</h3>

</div>
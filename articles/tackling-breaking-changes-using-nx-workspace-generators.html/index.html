<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta name="generator" content="Scully 0.0.0"><script id="article-micro-data" type="application/ld+json">
            {
            "@context": "https://schema.org/",
            "@type": "BlogPosting",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https://valor-software.com/articles/tackling-breaking-changes-using-nx-workspace-generators.html"
            },
            "headline": "Tackling breaking changes using Nx Workspace generators",
            "description": "Possible solution for managing Dependency Updates.",
            "image": {
                "@type": "ImageObject",
                "url": "https://valor-software.com/assets/articles/tackling-breaking-changes-using-nx-workspace-generators/Valor-Nx.png",
                "width": "",
                "height": ""
            },
            "author": {
                "@type": "Organization",
                "name": "Vyacheslav Chub"
            },
            "publisher": {
                "@type": "Organization",
                "name": "Valor Software",
                "logo": {
                "@type": "ImageObject",
                "url": "https://valor-software.com/assets/img/valor_img/valor-logo.svg",
                "width": "",
                "height": ""
                }
            },
            "datePublished": "Thu Jan 21 2023 10:45:55 GMT+0000 (Coordinated Universal Time)"
            }
        </script>
	<meta charset="utf-8">
	<title>Tackling breaking changes using Nx Workspace generators</title>
	<base href="/">
	<meta name="robots" content="all">
	<meta property="og:type" content="website">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:image" content="/assets/img/valor-img/valor_social.jpg">

	<!-- Twitter Meta Tags -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content="@ValorSoft">
	<meta name="twitter:creator" content="@ValorSoft">

	<link rel="icon" type="image/x-icon" href="favicon.ico">
	<script>
      window.intercomSettings = {
          app_id: "brxsww1a"
      };
	</script>
	<script src="assets/js/intercom-facade.js"></script>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-YD223JL5QN"></script>
	<script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
          dataLayer.push(arguments);
      }

      gtag('js', new Date());
	</script>
	<script type="text/javascript">
      window.onload = function () {
          if (window.self !== window.top) {
              document.body.innerHTML = `
                <div>
                  <h1>If you see this page, the valor site link you have clicked on is under Clickjacking security attack.</h1>
                  <h2>Please inform our team with the reference of the application from where you clicked this link.</h2>
                  <h2>Click <a href="https://valor-software.com" title='Valor site' target='blank'>here</a> to access valor site safely.</h2>
                </div>
              `;
          }
      };
	</script>
<style>:root{--swiper-theme-color:#007aff}:root{--swiper-navigation-size:44px}:root{--light_font_col:#E1E1E1}*,:before,:after{box-sizing:border-box}html{tab-size:4}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji"}html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";line-height:1.5}body{font-family:inherit;line-height:inherit}*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:currentColor}*,:before,:after{--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));border-color:currentColor;--tw-ring-inset:var(--tw-empty, );--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59, 130, 246, .5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-blur:var(--tw-empty, );--tw-brightness:var(--tw-empty, );--tw-contrast:var(--tw-empty, );--tw-grayscale:var(--tw-empty, );--tw-hue-rotate:var(--tw-empty, );--tw-invert:var(--tw-empty, );--tw-saturate:var(--tw-empty, );--tw-sepia:var(--tw-empty, );--tw-drop-shadow:var(--tw-empty, );--tw-filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}body,html{height:100%;--tw-bg-opacity:1;background-color:rgba(22,22,23,var(--tw-bg-opacity));scroll-behavior:smooth}</style><link rel="stylesheet" href="styles.a7de4e80bda7b8ae.css" media="all" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles.a7de4e80bda7b8ae.css"></noscript><style>[_nghost-mue-c36]{position:fixed;bottom:0;left:0;right:0;z-index:10000;width:100%;background:#252829;color:#fff;overflow:hidden;box-sizing:border-box;line-height:24px;display:flex;flex-wrap:nowrap;padding:16px 29px;align-items:center;animation:1s fadein ease-in-out both}.btn[_ngcontent-mue-c36]{display:block;padding:.4em .8em;font-size:.9em;font-weight:700;border-width:2px;border-style:solid;text-align:center;white-space:nowrap;border-color:transparent}@keyframes fadein{0%{opacity:0}to{opacity:1}}</style><style>.turbo-table{margin-top:25px}  .turbo-table tbody tr:not(:first-of-type){border-top:1px solid gray}  .turbo-table tbody tr:not(:first-of-type) td:not(:last-of-type){border-right:1px solid gray}  .turbo-table tbody tr:not(:first-of-type) td{padding:5px 10px}  tbody tr:first-of-type{text-align:center}  mark{background-color:#a9a9a9;color:#383838;border-radius:.3em;padding:.1em .25em}  .white{color:#fff}  .small-img{margin:auto;width:40%}  .block-citation{border-left-width:8px;--tw-border-opacity: 1;border-color:rgba(32,32,32,var(--tw-border-opacity));--tw-bg-opacity: 1;background-color:#2c2c2d}  .block-citation>.attribution{padding:0 16px 16px;text-align:right}  .block-citation>blockquote{border:0px}  .block-citation>blockquote>.paragraph:first-of-type:before{content:open-quote;float:left;font-size:3em;margin-right:4px;font-weight:700;line-height:.6em;color:rgba(226,78,99,var(--tw-text-opacity))}  .block-citation>blockquote>.paragraph:first-of-type:after{content:no-close-quote}</style><meta name="description" content="Possible solution for managing Dependency Updates."><meta property="og:title" content="Tackling breaking changes using Nx Workspace generators"><meta property="og:description" content="Possible solution for managing Dependency Updates."><meta property="twitter:title" content="Tackling breaking changes using Nx Workspace generators"><meta property="twitter:description" content="Possible solution for managing Dependency Updates."><style>
      swiper {
        display: block;
      }
    </style><script>window['ScullyIO']='generated';</script></head>
<body scully-version="0.0.0">
<valor-software-site-base-root _nghost-mue-c37="" ng-version="14.2.8"><top-menu _ngcontent-mue-c37=""><nav class="bg-grey_bg font-workSans text-base fixed top-0 w-full z-10"><div class="px-4 xl:px-28 lg:py-2.5"><div class="flex items-center justify-between h-16"><div class="flex-1 lg:flex-auto lg:hidden"><img src="assets/img/icons/burger-menu.svg" alt="burger menu icon"></div><!----><!----><div class="lg:flex flex-1 lg:flex-auto items-center"><div class="flex-shrink-0"><a routerlink="." class="cursor-pointer block justify-center flex" href="/"><img src="/assets/img/valor-img/valor-logo.svg" alt="Workflow" class="h-6 w-auto sm:h-14"></a></div><div class="hidden lg:block relative ml-20"><div class="flex space-x-2 leading-4"><div class="menu-item">For clients <div class="light-arrow"></div></div><a routerlink="/services" class="menu-item" href="/services">Services</a><a routerlink="/projects" class="menu-item" href="/projects">Portfolio</a><a routerlink="/careers" class="menu-item" href="/careers">Careers</a><a routerlink="/articles" class="menu-item active-route" href="/articles">Blog</a></div><menu-popover class="hidden lg:block"><div class="hidden lg:block"><div class="popover pt-10 px-10 z-20"><div class="arrow"></div><div class="flex justify-between flex-wrap"><div changesrconhover="" class="w-45% cursor-pointer text-light_font_col mb-12"><a href="/clients/startups"><div class="flex mb-2.5"><div class="flex items-center"><img src="/assets/img/icons/startups.svg"><h3 class="ml-2.5">Startups</h3></div><!----></div><div><p class="text-grey_font_col text-sm">Software development from scratch to market launch</p></div></a></div><div changesrconhover="" class="w-45% cursor-pointer text-light_font_col mb-12"><a href="/clients/enterprises"><div class="flex mb-2.5"><div class="flex items-center"><img src="/assets/img/icons/enterprises.svg"><h3 class="ml-2.5">Enterprises</h3></div><!----></div><div><p class="text-grey_font_col text-sm">Future-oriented solutions to solve today's problems and anticipate tomorrow’s needs</p></div></a></div><div changesrconhover="" class="w-45% cursor-pointer text-light_font_col mb-12"><a href="/clients/smbs"><div class="flex mb-2.5"><div class="flex items-center"><img src="/assets/img/icons/smbs.svg"><h3 class="ml-2.5">SMBs</h3></div><!----></div><div><p class="text-grey_font_col text-sm">Budget-wise solutions for small to medium-sized businesses</p></div></a></div><div changesrconhover="" class="w-45% cursor-pointer text-light_font_col mb-12"><a href="/clients/non-profit"><div class="flex mb-2.5"><div class="flex items-center"><img src="/assets/img/icons/non-profits.svg"><h3 class="ml-2.5">Non-profits</h3></div><!----></div><div><p class="text-grey_font_col text-sm">Technology solutions for non-governmental organizations</p></div></a></div><!----></div></div><div class="backdrop"></div></div><div class="adaptive-popover"><div><a href="/clients/startups"><div class="flex mb-7"><div class="flex items-center"><img src="/assets/img/icons/startups.svg"><h3 class="ml-2.5 text-xl">Startups</h3></div><!----></div></a></div><div><a href="/clients/enterprises"><div class="flex mb-7"><div class="flex items-center"><img src="/assets/img/icons/enterprises.svg"><h3 class="ml-2.5 text-xl">Enterprises</h3></div><!----></div></a></div><div><a href="/clients/smbs"><div class="flex mb-7"><div class="flex items-center"><img src="/assets/img/icons/smbs.svg"><h3 class="ml-2.5 text-xl">SMBs</h3></div><!----></div></a></div><div><a href="/clients/non-profit"><div class="flex"><div class="flex items-center"><img src="/assets/img/icons/non-profits.svg"><h3 class="ml-2.5 text-xl">Non-profits</h3></div><!----></div></a></div><!----></div></menu-popover></div></div><div class="lg:block flex-1 lg:flex-auto"><div class="flex items-end justify-end"><button type="button" class="btn-pink-border text-xs md:text-base"> Get in touch </button></div></div></div></div><div id="mobile-menu" class="adaptive-menu"><div class="px-2 pt-2 pb-3 space-y-1"><div class="menu-item">For clients <div class="light-arrow big"></div></div><menu-popover class="block lg:hidden !m-0"><div class="hidden lg:block"><div class="popover pt-10 px-10 z-20"><div class="arrow"></div><div class="flex justify-between flex-wrap"><div changesrconhover="" class="w-45% cursor-pointer text-light_font_col mb-12"><a href="/clients/startups"><div class="flex mb-2.5"><div class="flex items-center"><img src="/assets/img/icons/startups.svg"><h3 class="ml-2.5">Startups</h3></div><!----></div><div><p class="text-grey_font_col text-sm">Software development from scratch to market launch</p></div></a></div><div changesrconhover="" class="w-45% cursor-pointer text-light_font_col mb-12"><a href="/clients/enterprises"><div class="flex mb-2.5"><div class="flex items-center"><img src="/assets/img/icons/enterprises.svg"><h3 class="ml-2.5">Enterprises</h3></div><!----></div><div><p class="text-grey_font_col text-sm">Future-oriented solutions to solve today's problems and anticipate tomorrow’s needs</p></div></a></div><div changesrconhover="" class="w-45% cursor-pointer text-light_font_col mb-12"><a href="/clients/smbs"><div class="flex mb-2.5"><div class="flex items-center"><img src="/assets/img/icons/smbs.svg"><h3 class="ml-2.5">SMBs</h3></div><!----></div><div><p class="text-grey_font_col text-sm">Budget-wise solutions for small to medium-sized businesses</p></div></a></div><div changesrconhover="" class="w-45% cursor-pointer text-light_font_col mb-12"><a href="/clients/non-profit"><div class="flex mb-2.5"><div class="flex items-center"><img src="/assets/img/icons/non-profits.svg"><h3 class="ml-2.5">Non-profits</h3></div><!----></div><div><p class="text-grey_font_col text-sm">Technology solutions for non-governmental organizations</p></div></a></div><!----></div></div><div class="backdrop"></div></div><div class="adaptive-popover"><div><a href="/clients/startups"><div class="flex mb-7"><div class="flex items-center"><img src="/assets/img/icons/startups.svg"><h3 class="ml-2.5 text-xl">Startups</h3></div><!----></div></a></div><div><a href="/clients/enterprises"><div class="flex mb-7"><div class="flex items-center"><img src="/assets/img/icons/enterprises.svg"><h3 class="ml-2.5 text-xl">Enterprises</h3></div><!----></div></a></div><div><a href="/clients/smbs"><div class="flex mb-7"><div class="flex items-center"><img src="/assets/img/icons/smbs.svg"><h3 class="ml-2.5 text-xl">SMBs</h3></div><!----></div></a></div><div><a href="/clients/non-profit"><div class="flex"><div class="flex items-center"><img src="/assets/img/icons/non-profits.svg"><h3 class="ml-2.5 text-xl">Non-profits</h3></div><!----></div></a></div><!----></div></menu-popover><a routerlink="/services" class="menu-item" href="/services">Services</a><a routerlink="/projects" class="menu-item" href="/projects">Portfolio</a><a routerlink="/careers" class="menu-item" href="/careers">Careers</a><a routerlink="/articles" class="menu-item active-route" href="/articles">Blog</a></div></div></nav></top-menu><!----><div _ngcontent-mue-c37="" class="font-workSans" style="min-height: 100%;"><router-outlet _ngcontent-mue-c37=""></router-outlet><general-item><article _nghost-mue-c47=""><section _ngcontent-mue-c47="" class="first-section-half landing-section mt-4 bg-dark_title_col lg:!pb-32 !pb:8"><div _ngcontent-mue-c47="" class="container flex items-center flex-col"><breadcrumbs _ngcontent-mue-c47="" class="w-full hidden md:block"><div><div class="flex text-grey_font_col"><a href="/" class="underline cursor-pointer">Home</a><span>&nbsp;&gt;&nbsp;</span><a href="/articles" class="underline cursor-pointer"> Articles </a><!----><!----><!----><span>&nbsp;&gt;&nbsp;</span><a href="/" class="disabled"> Tackling Breaking Changes Using Nx Workspace Generators </a><!----><!----><!----><!----></div></div><!----></breadcrumbs><!----><!----><div _ngcontent-mue-c47="" class="w-full flex flex-col items-center md:mt-12 lg:mt-32 max-w-full lg:max-w-75% text-center text-light_title_col"><p _ngcontent-mue-c47="" class="text-20 mb-4">January 21, 2023</p><p _ngcontent-mue-c47="" class="text-large font-bold md:text-64 leading-66 mb-8 md:mb-14">Tackling breaking changes using Nx Workspace generators</p><div _ngcontent-mue-c47="" class="w-70 h-70 rounded-full overflow-hidden mb-4"><img _ngcontent-mue-c47="" class="w-full h-full object-cover" src="assets/articles/tackling-breaking-changes-using-nx-workspace-generators/Slava_Chub.jpg" alt="Vyacheslav Chub"></div><!----><!----><!----><p _ngcontent-mue-c47="" class="md:text-large text-24 mb-4">Vyacheslav Chub</p><!----><!----><!----><p _ngcontent-mue-c47="" class="text-20">Full Stack Software Engineer</p><!----></div></div></section><section _ngcontent-mue-c47="" class="landing-section"><div _ngcontent-mue-c47="" class="container pt-4 md:pt-12 flex items-center flex-col article-box !max-w-1010"><div _ngcontent-mue-c47="" class="max-w-full"><div class="paragraph">
<p><a href="https://nx.dev/" target="_blank" rel="noopener">The Nx ecosystem</a> is excellent because, on the one hand, it allows different teams to work under the same monorepo and build robust enterprise solutions. On the other hand, the basic Nx functionality is relatively easy. That’s why Nx-based solutions turned out more popular last time. Consequently, increasing monorepos include technologies such as React, Angular, NestJS, and even Golang. Moreover, these libraries and frameworks are not alone under the monorepos. They often use a lot of 3-d party libraries and custom modules. One of the most painful topics regarding software development, including Nx, is managing dependency updates. Especially dependencies with breaking changes that need to be resolved in order to get the application back into a working state. This article proposes one possible solution. It is not meant as a final solution and or source of truth. These are only initial thoughts about the topic.</p>
</div>
<div class="paragraph">
<p><a href="https://nx.dev/" target="_blank" rel="noopener">Nx official documentation</a> tells us regarding migrations the following.</p>
</div>
<div class="paragraph">
<p>"Not only does nx migrate update you to the latest version of Nx, but it also updates the versions of dependencies that we support and test, such as Jest and Cypress. You can also use the migrate command to update any Nx plugin."</p>
</div>
<div class="paragraph">
<p>The Nx team did a great job because you can update the whole solution as efficiently as possible. That’s why I recommend the <a href="https://nx.dev/core-features/automate-updating-dependencies" target="_blank" rel="noopener">following reading</a>. Many packages have supported it. But "many" is not equal to "all." Let’s look at the following case.</p>
</div>
<div class="paragraph">
<p>There is a <a href="https://github.com/buchslava/nx-custom-migration-demo" target="_blank" rel="noopener">demo monorepo</a>. It contains a <a href="https://github.com/buchslava/nx-custom-migration-demo/tree/main/apps/client" target="_blank" rel="noopener">React Application</a>. Also, it includes a <a href="https://github.com/buchslava/nx-custom-migration-demo/tree/main/libs/common-lib" target="_blank" rel="noopener">common lib</a>.</p>
</div>
<div class="paragraph">
<p>Let’s dig into the demo functionality and code specific.</p>
</div>
<div class="sect1">
<h2 id="_the_client">The Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The client React app is quite simple. Let’s run it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">git clone git@github.com:buchslava/nx-custom-migration-demo.git
npm i
npx nx run client:serve</code></pre>
</div>
</div>
<div class="imageblock img">
<div class="content">
<img src="assets/articles/tackling-breaking-changes-using-nx-workspace-generators/image1.png" alt="image1">
</div>
</div>
<div class="paragraph">
<p>The behavior of a couple of forms above is similar. They demonstrate the sum of two numbers. Related code is placed <a href="https://github.com/buchslava/nx-custom-migration-demo/blob/main/apps/client/src/app/app.tsx" target="_blank" rel="noopener">here</a>. Let’s look at the code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">import { sumProxy } from '@nx-custom-migration-demo/common-lib';
import { useState } from 'react';
import { deprecatedSum } from 'try-lib';

export function App() {
  const [a, setA] = useState&lt;number&gt;(0);
  const [b, setB] = useState&lt;number&gt;(0);
  const [c, setC] = useState&lt;number&gt;();

  const [d, setD] = useState&lt;number&gt;(0);
  const [e, setE] = useState&lt;number&gt;(0);
  const [f, setF] = useState&lt;number&gt;();

  return (
    &lt;&gt;
      &lt;div&gt;
        &lt;h2&gt;Using internal lib&lt;/h2&gt;
        &lt;div&gt;
          &lt;input
            value={a}
            onChange={(e) =&gt; {
              setA(+e.target.value);
            }}
          /&gt;
          +
          &lt;input
            value={b}
            onChange={(e) =&gt; {
              setB(+e.target.value);
            }}
          /&gt;
          &lt;button
            onClick={() =&gt; {
              setC(sumProxy(a, b));
            }}
          &gt;
            is
          &lt;/button&gt;
          &lt;span&gt;{c}&lt;/span&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div&gt;
        &lt;h2&gt;Using external lib&lt;/h2&gt;
        &lt;div&gt;
          &lt;input
            value={d}
            onChange={(e) =&gt; {
              setD(+e.target.value);
            }}
          /&gt;
          +
          &lt;input
            value={e}
            onChange={(e) =&gt; {
              setE(+e.target.value);
            }}
          /&gt;
          &lt;button
            onClick={() =&gt; {
              setF(deprecatedSum(d, e));
            }}
          &gt;
            is
          &lt;/button&gt;
          &lt;span&gt;{f}&lt;/span&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/&gt;
  );
}

export default App;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pay attention to the following points.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">&lt;button
  onClick={() =&gt; {
    setC(sumProxy(a, b));
  }}
&gt;
  is
&lt;/button&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above describes the result calculation for the first form. We take <mark>sumProxy</mark> from the internal library <mark>@nx-custom-migration-demo/common-lib.</mark></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">&lt;button
  onClick={() =&gt; {
    setF(deprecatedSum(d, e));
  }}
&gt;
  is
&lt;/button&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above describes the result calculation for the second form. We take <mark>deprecatedSum</mark> from the external library <mark>try-lib</mark>.
If we look at <mark>package.json</mark> we can find the library.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"try-lib": "^1.0.1",</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_the_internal_common_library">The Internal (Common) Library</h3>
<div class="paragraph">
<p>The library is placed <a href="https://github.com/buchslava/nx-custom-migration-demo/tree/main/libs/common-lib" target="_blank" rel="noopener">here</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">import { deprecatedSum } from "try-lib";

export function sumProxy(a: number, b: number): number {
  return deprecatedSum(a, b);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It looks similar to the calculation for the second form on the client because of <mark>deprecatedSum</mark> from <mark>try-lib</mark>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_external_library">The external Library</h3>
<div class="paragraph">
<p>It’s time to look at the external library. You can find the library on <a href="https://github.com/buchslava/try-lib" target="_blank" rel="noopener">github</a> and <a href="https://www.npmjs.com/package/try-lib" target="_blank" rel="noopener">npm</a>.
There is a couple of versions.</p>
</div>
<div class="sect3">
<h4 id="_version_1_0_1">Version <mark>1.0.1</mark></h4>
<div class="paragraph">
<p>This version is based on the following code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">export function deprecatedSum(a: number, b: number): number {
  return a + b;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_version_2_0_0">Version <mark>2.0.0</mark></h4>
<div class="paragraph">
<p>The main feature of this version is that this version contains a breaking change. The breaking change is that <mark>deprecatedSum</mark> has changed to <mark>sum</mark>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">export function sum(a: number, b: number): number {
  return a + b;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_issue">The Issue</h3>
<div class="paragraph">
<p>Pay attention that now we use <mark>try-lib@1.0.1</mark>. A couple of important places look the following.</p>
</div>
<div class="imageblock img">
<div class="content">
<img src="assets/articles/tackling-breaking-changes-using-nx-workspace-generators/image2.png" alt="image2">
</div>
</div>
<div class="paragraph">
<p>Let’s change it to <mark>version 2.0.0</mark> and run <mark>npm i</mark>.</p>
</div>
<div class="imageblock img">
<div class="content">
<img src="assets/articles/tackling-breaking-changes-using-nx-workspace-generators/image3.png" alt="image3">
</div>
</div>
<div class="paragraph">
<p>It’s easy to predict the result.</p>
</div>
<div class="imageblock img">
<div class="content">
<img src="assets/articles/tackling-breaking-changes-using-nx-workspace-generators/image4.png" alt="image4">
</div>
</div>
<div class="paragraph">
<p>We have a broken solution because <mark>try-lib</mark> has a breaking change.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_solution">The Solution</h3>
<div class="paragraph">
<p>Of course, we can fix the breaking changes manually and forget this story. But this approach is suitable mainly for Ad hoc or for individual developers. We need to count the following factors when discussing teams or enterprise solutions.</p>
</div>
<div class="sect3">
<h4 id="_factor_1_time">Factor 1. Time.</h4>
<div class="paragraph">
<p>We don’t know when we should apply the changes. Let’s imagine a team has decided to bump the library version. One of the developers provides a new branch, including fixes. But the manager postponed this branch merging, and the team had no idea when the team would continue with this task. What happens there? The team wasted time because the branch was outdated, and in most cases reasonable to forget the branch and repeat breaking changes and fixing again. Another option is Version Control System (VCS) conflict resolution. But this approach is the worst because we risk damaging the solution. Of course, it depends on the number of new modifications and breaking changes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_factor_2_history">Factor 2. History.</h4>
<div class="paragraph">
<p>Of course, the VCS (say, Git) can log the changes. Despite this, information could be lost due to rebasing. Perhaps we must invent a new approach to log the changes more efficiently.</p>
</div>
</div>
<div class="sect3">
<h4 id="_factor_3_independence">Factor 3. Independence.</h4>
<div class="paragraph">
<p>As I previously told you, Nx has a powerful migration functionality that allows upgrading Nx with other dependencies it supports. But let’s imagine the situation when we don’t need to upgrade the Nx version. Still, at the same time, we need to upgrade an individual dependency by automatically breaking changes and fixing them exactly as Nx migration does.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requirements">Requirements.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Analyzing the above, let’s gather the requirements for the task.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We need to upgrade an individual dependency at any time. That’s why the following approach makes sense. A developer or a team doesn’t work with the result code; on the contrary, they prepare an algorithm (functionality) that transforms the solution according to the expected dependency version. It allows the team to apply the changes at any time when needed. On the one hand, it makes the project more expensive. On the other hand, it decreases many risks. We have a predictable flow because we know what happens (the result of applying) and how it happens (the algorithm/functionality). Also, there is one more important thing. If something wrong happens, we can roll back the changes and repeat them easily because we don’t need to provide manual jobs.<br></p>
</li>
<li>
<p>We need to deal with different versions of the package.<br></p>
</li>
<li>
<p>The functionality above should be Nx-friendly.<br></p>
</li>
<li>
<p>The most important thing here is that the functionality above could be shared between Nx society and used as a part of a future Nx plugin. More information <a href="https://nx.dev/packages/nx-plugin" target="_blank" rel="noopener">here</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation">Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When I was thinking about the implementation thoughts above, I faced with <a href="https://blog.nrwl.io/using-nx-workspace-generators-to-scaffold-new-blog-posts-8c8162cf857b" target="_blank" rel="noopener">Using Nx Workspace generators to scaffold</a> new blog posts by <a href="https://medium.com/@juristr" target="_blank" rel="noopener">Juri Strumpflohner</a>. I recommend this article because I found this helpful approach to resolving my task there. Briefly, my plan is about a new workspace generator creation. The workspace generator should get the related package name and modify the source code afterward.</p>
</div>
<div class="paragraph">
<p>It’s time to dig into the solution.</p>
</div>
<div class="paragraph">
<p>First, I created the new workspace generator with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npx nx g @nrwl/workspace:workspace-generator code-transformer</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a new folder in <mark>tools/generators/code-transformer</mark> with an <mark>index.ts</mark> and a <mark>schema.json</mark> file.</p>
</div>
<div class="sect2">
<h3 id="_adjusting_the_schema_json">Adjusting the <mark>schema.json</mark></h3>
<div class="paragraph">
<p>This file describes the metadata of our generator. It allows Nx to discover the generator and provides metadata such as the possible argument the generator takes for validation purposes or dynamically rendering a UI like Nx Console does.</p>
</div>
<div class="paragraph">
<p>In our case, we have only one input parameter for the generator, and we need to pass a related dependency name.</p>
</div>
<div class="paragraph">
<p>I opened the <mark>tools/generators/code-transformer/schema.json</mark> and adjusted the schema to match our requirements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "$schema": "http://json-schema.org/schema",
  "cli": "nx",
  "$id": "code-transformer",
  "type": "object",
  "properties": {
    "package": {
      "type": "string",
      "description": "Package",
      "$default": {
        "$source": "argv",
        "index": 0
      }
    }
  },
  "required": ["package"]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_transformation_runner">Code transformation runner</h3>
<div class="paragraph">
<p>Next, I opened the <mark>tools/generators/code-transformer/index.ts</mark> and put my solution there.
Please, read the comments in the code. It will help you to understand the solution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">import { Tree } from '@nrwl/devkit';
import * as fs from 'fs';
import * as path from 'path';
import * as semver from 'semver';
import * as util from 'util';
import { Project } from 'ts-morph';
import compile from './compiler';

const readFile = util.promisify(fs.readFile);

export default async function (tree: Tree, schema: any) {
  // Get "package.json"
  const packageJson: any = JSON.parse(
    (await readFile('package.json')).toString()
  );
  // "schema.package" contains the related dependency name
  // if it does not exist in "package.json" then
  // throw an error and stop the generator
  if (!packageJson.dependencies[schema.package]) {
    throw Error(`Dependency "${schema.package}" is not found in package.json`);
  }
  // Get an existing version of the related dependency
  const existingVersion = packageJson.dependencies[schema.package].replace(
    /^[\D]{1}/,
    ''
  );
  // Get `updates.json` config
  const updatesJson: any = JSON.parse(
    (await readFile('tools/updates/updates.json')).toString()
  );
  const activities: string[] = [];
  // Iterate over `updates` array
  for (const record of updatesJson.updates) {
    // if the existing (bumped) version from the package is more than "changes"-based and the package is expected
    // add the related function to activities
    if (schema.package === record.package &amp;&amp; semver.gte(existingVersion, record.version)) {
      activities.push(path.resolve(process.cwd(), record.implementation));
    }
  }
  // Compile the related TS files
  compile(activities, {});

  // In this example, we use only "ts-morph" for the source code transformation
  const project = new Project();
  // Pass expected paths of source code
  const sources = [
    'libs/**/*.ts',
    'libs/**/*.tsx',
    'apps/client/**/*.ts',
    'apps/client/**/*.tsx',
  ];

  for (const activity of activities) {
    // Get related transformer-function
    const fn = require(activity).default;
    // Run it
    fn(project, sources);
  }
  // Save the changes
  await project.save();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can read explained source code above <a href="https://github.com/buchslava/nx-custom-migration-demo/tree/main/tools/generators/code-transformer" target="_blank" rel="noopener">here</a>.
It’s time to dig into the "Updates" concept. There is the following structure:</p>
</div>
<div class="imageblock img">
<div class="content">
<img src="assets/articles/tackling-breaking-changes-using-nx-workspace-generators/image5.png" alt="image5">
</div>
</div>
<div class="paragraph">
<p>File <a href="https://github.com/buchslava/nx-custom-migration-demo/blob/main/tools/updates/updates.json" target="_blank" rel="noopener">update/update.json</a> represents a configuration regarding all updates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <mark>updates</mark> value is an array of records.<br></p>
</li>
<li>
<p>Each record contains the following data: <mark>package</mark> (dependency name), <mark>description</mark> (change), and <mark>version</mark>. But the most important data here is <mark>implementation</mark>. It represents a file name containing the transformation’s code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our case, the <mark>try-lib</mark> dependency contains changes for version <mark>2.0.0</mark> or more than this version.</p>
</div>
<div class="paragraph">
<p>Likewise, as in the previous code, I will explain how transformation works as in the previous code. Please, read the comments.</p>
</div>
<div class="paragraph">
<p>One important note. The following Typescript transformations idea is based on <mark>ts-morph</mark> library. Please, read <a href="https://ts-morph.com/" target="_blank" rel="noopener">ts-morph documentation</a>.</p>
</div>
<div class="paragraph">
<p>Let’s look at <mark>tools/changes-registry/index.ts</mark> (you can find the related source <a href="https://github.com/buchslava/nx-custom-migration-demo/blob/main/tools/updates/try-lib.2.0.0.fix-deprecated-sum.ts" target="_blank" rel="noopener">here</a>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">import { Project, SyntaxKind, Node } from 'ts-morph';

// This is a recursive function that changes
// some code fragments ("oldName" to "newName")
// according to its Node Type
function walkAndChange(
  node: Node,
  nodeKinds: SyntaxKind[],
  oldName: string,
  newName: string
) {
  // criteria matching
  if (
    nodeKinds.includes(node.getKind()) &amp;&amp;
    node.getFullText().trim() === oldName
  ) {
    node.replaceWithText(newName);
    return;
  }
  // recursive call
  node.forEachChild((c) =&gt; walkAndChange(c, nodeKinds, oldName, newName));
}

// Function-transformer takes Ts-morph project and related paths
export default function (project: Project, sources: string[]) {
  project.addSourceFilesAtPaths(sources);
  const files = project.getSourceFiles();

  // iterate the related source files
  for (const file of files) {
    // change "deprecatedSum" to "sum" in
    // imports (SyntaxKind.ImportSpecifier) and
    // in the rest (SyntaxKind.Identifier) of the code
    walkAndChange(
      file,
      [SyntaxKind.Identifier, SyntaxKind.ImportSpecifier],
      'deprecatedSum',
      'sum'
    );
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, the example above provides a fundamental transformation, and this logic could be much more difficult in real life.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_the_solution">Use the solution</h3>
<div class="paragraph">
<p>It’s time to use the solution, and let’s repeat it from the beginning</p>
</div>
<div class="sect3">
<h4 id="_the_bump">The bump</h4>
<div class="paragraph">
<p>Change the version of <mark>try-lib</mark> from <mark>1.0.1</mark> to <mark>2.0.0</mark> and run <mark>npm i</mark>.</p>
</div>
<div class="imageblock img">
<div class="content">
<img src="assets/articles/tackling-breaking-changes-using-nx-workspace-generators/image6.png" alt="image6">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_breaking_changes">The breaking changes</h4>
<div class="imageblock img">
<div class="content">
<img src="assets/articles/tackling-breaking-changes-using-nx-workspace-generators/image7.png" alt="image7">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fixing">Fixing</h4>
<div class="paragraph">
<p>Run the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npx nx workspace-generator code-transformer -- try-lib --dry-run</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_voilà">Voilà!</h4>
<div class="imageblock img">
<div class="content">
<img src="assets/articles/tackling-breaking-changes-using-nx-workspace-generators/image8.png" alt="image8">
</div>
</div>
<div class="paragraph">
<p>Let’s run the app to make sure that it works well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npx nx run client:serve</code></pre>
</div>
</div>
<div class="imageblock img">
<div class="content">
<img src="assets/articles/tackling-breaking-changes-using-nx-workspace-generators/image9.png" alt="image9">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_roadmap">The Roadmap</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Because this article represents only an idea or a concept, I’d like to focus on points that would be nice to consider in the future.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first helpful thing is to store information about past updates, and we don’t need to repeat transformations that were passed before.<br></p>
</li>
<li>
<p>We need to deal with other languages, not only Typescript.<br></p>
</li>
<li>
<p>Finally, we need to have a more flexible set of the generator’s input parameters.</p>
</li>
</ul>
</div>
</div>
</div></div></div></section><!----><section _ngcontent-mue-c47="" class="landing-section"><h1 _ngcontent-mue-c47="" class="main-title">More Articles</h1><div _ngcontent-mue-c47="" class="container"><blog-preview _ngcontent-mue-c47=""><swiper class="article_swiper swiper swiper-initialized swiper-horizontal swiper-pointer-events"><!----><!----><div class="swiper-pagination swiper-pagination-clickable swiper-pagination-bullets swiper-pagination-horizontal"><span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span><span class="swiper-pagination-bullet"></span><span class="swiper-pagination-bullet"></span></div><!----><div class="swiper-wrapper" style="transform: translate3d(0px, 0px, 0px);"><!----><!----><div data-swiper-slide-index="0" class="swiper-slide swiper-slide-active" style="width: 733px; margin-right: 40px;"><!----><a href="/articles/the-evolution-of-web-application-development" class="block w-full cursor-pointer"><blog-portfolio-item><div class="article-item"><div class="img-container-auto zoom-img-scale"><img class="w-full h-full object-cover" src="assets/articles/the-evolution-of-web-application-development/Main_Evolution_Web_Development.png" alt="The Evolution of Web Application Development"></div><div class="text-container"><p>The Evolution of Web Application Development</p></div></div></blog-portfolio-item></a><!----><!----><!----><!----><!----></div><div data-swiper-slide-index="1" class="swiper-slide swiper-slide-next" style="width: 733px; margin-right: 40px;"><!----><a href="/articles/zero-cost-way-on-react-d3" class="block w-full cursor-pointer"><blog-portfolio-item><div class="article-item"><div class="img-container-auto zoom-img-scale"><img class="w-full h-full object-cover" src="assets/articles/zero-cost-way-on-react-d3/Main_zero-cost-way-on-react-d3.png" alt="Zero-cost Way on React &amp; D3."></div><div class="text-container"><p>Zero-cost Way on React &amp; D3.</p></div></div></blog-portfolio-item></a><!----><!----><!----><!----><!----></div><div data-swiper-slide-index="2" class="swiper-slide" style="width: 733px; margin-right: 40px;"><!----><a href="/articles/multi-threading-for-impatient-rust-learners" class="block w-full cursor-pointer"><blog-portfolio-item><div class="article-item"><div class="img-container-auto zoom-img-scale"><img class="w-full h-full object-cover" src="assets/articles/multi-threading-for-impatient-rust-learners/Main_multi-threading-for-impatient.png" alt="Multi-threading for Impatient Rust Learners."></div><div class="text-container"><p>Multi-threading for Impatient Rust Learners.</p></div></div></blog-portfolio-item></a><!----><!----><!----><!----><!----></div><!----><!----><!----><!----></div><!----></swiper><!----><!----></blog-preview></div></section><!----><!----></article><!----><!----><!----></general-item><!----></div><app-footer _ngcontent-mue-c37=""><footer><div class="px-4 xl:px-28 pb-6"><div class="w-full flex flex-col-reverse md:flex-row items-center justify-between border-t-2 border-placeholder_col pt-6"><div class="flex-shrink-0"><a routerlink="." class="cursor-pointer" href="/"><img src="/assets/img/valor-img/valor-logo.svg" alt="Workflow" class="h-14 w-70 md:w-full"></a></div><div class="hidden lg:flex items-center"><div class="leading-4 flex"><div class="lg:w-75 !mr-10"><a href="https://www.linkedin.com/company/valor-software/about/" target="_blank" rel="noopener" class="block transition-all text-header_font_col hover:font-bold">LinkedIn</a></div><div class="lg:w-75 !mr-10"><a href="https://www.facebook.com/valorsoftware/" target="_blank" rel="noopener" class="block transition-all text-header_font_col hover:font-bold">Facebook</a></div><div class="lg:w-75 !mr-10"><a href="https://twitter.com/ValorSoft" target="_blank" rel="noopener" class="block transition-all text-header_font_col hover:font-bold">Twitter</a></div><div class="lg:w-75 !mr-10"><a href="https://www.instagram.com/valor.software/" target="_blank" rel="noopener" class="block transition-all text-header_font_col hover:font-bold">Instagram</a></div><div class="lg:w-75 !mr-10"><a href="https://dribbble.com/valor-labs" target="_blank" rel="noopener" class="block transition-all text-header_font_col hover:font-bold">Dribbble</a></div><div class="lg:w-75 !mr-10"><a href="https://www.behance.net/ValorSoftware" target="_blank" rel="noopener" class="block transition-all text-header_font_col hover:font-bold">Behance</a></div><div class="lg:w-75 !mr-10"><a href="https://github.com/valor-software" rel="noopener" class="block transition-all text-header_font_col hover:font-bold">GitHub</a></div><div class="lg:w-75 !mr-10"><a href="https://valorsoftware.medium.com/" class="block transition-all text-header_font_col hover:font-bold">Medium</a></div></div><div class="hidden 2xl:block 2xl:flex-1 2xl:flex-auto ml-10"><div class="flex items-end justify-end"><button type="button" class="btn-pink-border text-xs md:text-base"> Get in touch </button></div></div></div><div class="flex flex-wrap lg:hidden mb-4 md:mb-0 justify-center md:justify-between w-full md:w-auto"><a href="https://www.linkedin.com/company/valor-software/about/" target="_blank" rel="noopener" class="w-20% md:w-auto flex justify-center md:mr-10 text-header_font_co mb-4 md:mb-0"><img src="assets/img/icons/social/linkedin.svg" alt=""></a><a href="https://www.instagram.com/valor.software/" target="_blank" rel="noopener" class="flex justify-center w-20% md:w-auto block md:mr-10 text-header_font_col mb-4 md:mb-0"><img src="assets/img/icons/social/instagram.svg" alt=""></a><a href="https://twitter.com/ValorSoft" target="_blank" rel="noopener" class="flex justify-center w-20% md:w-auto block md:mr-10 text-header_font_col mb-4 md:mb-0"><img src="assets/img/icons/social/twitter.svg" alt=""></a><a href="https://dribbble.com/valor-labs" target="_blank" rel="noopener" class="flex justify-center w-20% md:w-auto block md:mr-10 text-header_font_col mb-4 md:mb-0"><img src="assets/img/icons/social/dribble.svg" alt=""></a><a href="https://www.behance.net/ValorSoftware" target="_blank" rel="noopener" class="flex justify-center w-20% md:w-auto block md:mr-10 text-header_font_col mb-4 md:mb-0"><img src="assets/img/icons/social/behance.svg" alt=""></a><a href="https://www.facebook.com/valorsoftware/" target="_blank" rel="noopener" class="flex justify-center w-20% md:w-auto block md:mr-10 text-header_font_col mb-4 md:mb-0"><img src="assets/img/icons/social/facebook.svg" alt=""></a><a href="https://github.com/valor-software" target="_blank" rel="noopener" class="flex justify-center md:mr-10 w-20% md:w-auto block text-header_font_col mb-4 md:mb-0"><img src="assets/img/icons/social/github.svg" alt=""></a><a href="https://valorsoftware.medium.com/" target="_blank" rel="noopener" class="flex justify-center w-20% md:w-auto block text-header_font_col mb-4 md:mb-0"><img src="assets/img/icons/social/medium.svg" alt=""></a></div></div><div class="flex flex-col justify-center mt-4 md:mt-7"><p class="m-0 text-center text-header_font_col text-sm">© 2023, Valor Software All Rights Reserved</p><a routerlink="/privacy-policy" class="m-0 text-center text-header_font_col text-sm link" href="/privacy-policy">Privacy Policy </a></div></div></footer></app-footer><!----><cookie-consent-banner _ngcontent-mue-c37="" _nghost-mue-c36=""><div _ngcontent-mue-c36="" class="banner flex flex-col items-center lg:flex-row justify-between px-4 xl:px-20 font-workSans !w-full"><div _ngcontent-mue-c36="" class="flex flex-col"><span _ngcontent-mue-c36="" class="text-20">This website uses cookies.</span><span _ngcontent-mue-c36="" id="cookieconsent:desc" class="leading-18"> We use cookies to make sure this website can function. By continuing to browse this website, you agree to our use of cookies. <a _ngcontent-mue-c36="" aria-label="learn more about our privacy policy" href="https://valor-software.com/privacy-policy" target="_blank" class="text-center text-header_font_col text-sm link">Learn more </a></span></div><div _ngcontent-mue-c36="" class="flex items-center pt-5 lg:pt-0"><button _ngcontent-mue-c36="" class="btn btn-pink flex md:justify-between justify-center py-5 px-10 w-full lg:w-auto"> Accept all cookies </button></div></div></cookie-consent-banner><!----></valor-software-site-base-root>
<script async="" src="assets/js/prettify.min.js"></script>
<script id="ScullyIO-transfer-state"></script><script src="runtime.aea33d7ca40f4ebb.js" type="module"></script><script src="polyfills.f39c60c21adb9eb1.js" type="module"></script><script src="main.88db8899f1d9699c.js" type="module"></script>

</body></html>
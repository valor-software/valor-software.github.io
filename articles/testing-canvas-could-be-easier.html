<html data-wf-domain="https://valor-software.com" data-wf-page="5df374d1014f24c851af97bf" data-wf-site="5c3f0ad89f55ca3a4f8c174c"><head><meta charset="utf-8"><title>Testing Canvas could be easier</title><meta content="We’ll take a deep dive into our next experiment with automated testing using Applitools and Cypress: testing <canvas> HTML elements." name="description"><meta content="Testing Canvas could be easier" property="og:title"><meta content="We’ll take a deep dive into our next experiment with automated testing using Applitools and Cypress: testing <canvas> HTML elements." property="og:description"><meta content="https://valor-software.com/assets/images/5cadcf20a10ee1f986d98a29_canvas.png" property="og:image"><meta content="Testing Canvas could be easier" property="twitter:title"><meta content="We’ll take a deep dive into our next experiment with automated testing using Applitools and Cypress: testing <canvas> HTML elements." property="twitter:description"><meta content="https://valor-software.com/assets/images/5cadcf20a10ee1f986d98a29_canvas.png" property="twitter:image"><meta property="og:type" content="website"><meta content="summary_large_image" name="twitter:card"><meta content="width=device-width, initial-scale=1" name="viewport"><link href="https://valor-software.com/assets/css/valor.e6bbdf646.min.css" rel="stylesheet" type="text/css"><script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script><script type="text/javascript">WebFont.load({  google: {    families: ["Lato:100,100italic,300,300italic,400,400italic,700,700italic,900,900italic","Source Code Pro:regular"]  }});</script><!--[if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif]--><script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script><link href="https://valor-software.com/assets/images/5c811f6cd8195286971e9cb2_fav32.png" rel="shortcut icon" type="image/x-icon"><link href="https://valor-software.com/assets/images/5c811f71231350647fd8219d_fav256.png" rel="apple-touch-icon"><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-73071494-2"></script><script type="text/javascript">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-73071494-2', {'anonymize_ip': false});</script><!--Social media cover image-->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@ValorSoft">
<meta name="twitter:creator" content="@ValorSoft">
<meta property="og:image" content="https://valor-software.com/assets/images/5c9ca628202d433b51139d07_valor__soc.jpg">
<!-- Google console -->
<meta name="google-site-verification" content="V8GuXYLElkB-DyKBZ-F37ByQFJBrIwsT_v_N9kULChY">
<style>
/*Reset apple form styles*/
input, textarea, select { 
-webkit-appearance: none; 
-moz-appearance: none; 
appearance: none; border-radius: 0; 
background-image: none; }  
/*Remove legature for the font*/
* {
font-variant-ligatures: none;
}
</style>
<!--<meta name="google-site-verification" content="aKWCJbKr9azHpYeEU_4-omBBlky5cQKJgakGXnBcteU" />--><style>
/*Blog Highlight CSS*/
code, kbd, pre, samp {
    font-size: 0.8em !important;
    line-height: 1.6em !important;
}
.hljs {
    padding: 20px !important;
}
.rich-text h6 {
    word-wrap: break-word;
}
</style>
<!--Blog Highlight JS-->
<link rel="stylesheet" href="https://valor-software.com/assets/images/github.css">
<script charset="UTF-8" src="https://valor-software.com/assets/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script></head><body><div data-collapse="medium" data-animation="over-left" data-duration="400" data-doc-height="1" role="banner" class="navbar w-nav"><div class="container"><div class="nav"><a href="https://valor-software.com" class="brand w-nav-brand"><img src="https://valor-software.com/assets/images/5c595f3c4983ad4f7e7701c0_5c4ae3480900f7a7d3ce36d6_02-svg-valor-software-logo-white-text.svg" alt="Valor Software logo"></a><nav role="navigation" class="navbar__links w-nav-menu"><a href="https://valor-software.com/services.html" class="navbar__link">Services</a><a href="https://valor-software.com/clients.html" class="navbar__link">Clients</a><a href="https://valor-software.com/about.html" class="navbar__link">About</a><a href="https://valor-software.com/approach.html" class="navbar__link">Approach</a><a href="https://valor-software.com/careers.html" class="navbar__link">Careers</a><a href="https://valor-software.com/blog.html" class="navbar__link">Blog</a><a href="https://valor-software.com/contact.html" class="navbar__link">Contact</a><a rel="noreferrer" href="https://github.com/valor-software" target="_blank" class="nav__link w-inline-block"><img src="https://valor-software.com/assets/images/5c4f2b2edfbd6c3b9f281ea9_github.svg" width="40" height="40" alt="Github link" class="image-3"></a></nav></div><nav class="menu-btn w-nav-button"><div class="navbar_menu-icon w-icon-nav-menu"></div></nav></div></div><div style="background-image:url(&quot;https://valor-software.com/assets/images/5d8210136e887f04a1d85ab8_canvas.jpg&quot;)" class="header"><div class="container container__narrow"><div class="header__wrap"><h1 class="hero__heading hero__heading-blog">Testing Canvas could be easier</h1><div class="auth__wrap"><a href="https://valor-software.com/persons/ludmila-nesvitiy.html" class="author__link w-inline-block"><div class="auth__photo"><div style="background-image:url(&quot;https://valor-software.com/assets/images/5f69eabbb804c9c13508347a_nesvitiy.jpg&quot;)" class="auth__photo-ava"></div></div><div class="auth__desc"><h2 class="blog-author__author-name">Ludmila Nesvitiy</h2><h6 class="blog-author__role">QA Automation Engineer</h6></div></a></div><div class="art__date"><div class="auth__date">April 16, 2019</div></div></div></div><div class="p-header p-header--blue"></div></div><div class="section-w"><div class="container container__narrow"><div class="rich-text w-richtext"><p>At Valor Software, we, with the help of generous contributors, developed a set of open source projects, that allow developers to build apps quicker and more qualitative. This should be helpful for other software development companies, yeah. Also, we put a lot of effort into experimenting with automated testing to make sure that those libraries work properly. That’s why now we’ll take a deep dive into our next experiment: testing &lt;canvas&gt; HTML elements.</p><h4>Project description</h4><p>ng2-charts is a small library that contains Angular directives and provides the possibility to integrate a number of types of charts: line, bar, radar, pie, polarArea, doughnut, bubble, and scatter.</p><h4>Source data</h4><p>There are no UI/E2E tests at all. We only have a small number of unit tests out there.</p><h4>Goal</h4><p>Quickly create the scope of UI or E2E tests to check basic charts on the Demo site.</p><h4>Problems</h4><p>Creating scope of tests for Demo site might not seem like a complex task, because <a href="https://valor-software.com/ng2-charts/" data-rt-link-type="external">Demo site</a> contains only a few pages, but let’s look a b-i-it deeper:</p><figure class="w-richtext-figure-type-image w-richtext-align-fullwidth" data-rt-type="image" data-rt-align="fullwidth" data-rt-max-width="1261px" style="max-width:1261px"><div><img alt="image6" src="https://valor-software.com/assets/images/5cac9625b32e397fc8d542c3_VhINC-U1hfiJ6IpgLQk_y7PCGNprGcBeGOps1QdrRi2TaALTEDcLWwdRyMmZF0DrB4L6KlfESRBtvsfb-ui52gTxDT_B1fP9jwAtzM_748d75ZK2DfTpVazZicu1h5flRfmWzpGF.png"></div></figure><p>Well, we have a single HTML element, which consists of graphic elements, and yeah it's the &lt;canvas&gt;.<br>FYI, according to MDN:</p><blockquote>&lt;canvas&gt; is an HTML element which can be used to draw graphics via scripting (usually JavaScript). This can, for instance, be used to draw graphs, combine photos, or create simple (and not so simple) animations…</blockquote><p>That means we can interact with elements using nothing but an imitation of mouse actions. Since our goal is to check for the standard basic functionality, image comparison should be enough.</p><h4>Implementation step 1. Testing main page with Cypress</h4><pre><code class="javascript">describe('Main Page', () =&gt; {
it(`navigate to main Demo page and check info`, () =&gt; {
 const topBarSelector = 'mat-toolbar';
 const mainContentSelector = 'main';
 cy.visit(''); cy.get(topBarSelector).should('be.visible')
  .eyesOpen({
   appName: 'NG2-charts',
   testName: `NG2-charts Main Page Top Bar`,
   browser: browsers
  })
  .eyesCheckWindow({
   sizeMode: 'selector',
   selector: topBarSelector,
   sendDom: false,
  })
  .eyesClose(); cy.get(mainContentSelector).should('be.visible')
  .eyesOpen({
   appName: 'NG2-charts',
   testName: `NG2-charts Main Page Content`,
   browser: browsers
  })
  .eyesCheckWindow({
   sizeMode: 'selector',
   selector: mainContentSelector,
   sendDom: false,
  })
  .eyesClose();
});
});</code></pre><p>Now that the basic test which opens the page and checks two main elements to make sure their visible is ready, we can move forward. Oops, here goes the first issue. When Cypress test runs and finishes, everything seems to be okay. Our chart is visible. However, once we start going through the steps inside the Cypress browser, we’ll see space instead of our chart.</p><figure class="w-richtext-figure-type-image w-richtext-align-fullwidth" data-rt-type="image" data-rt-align="fullwidth" data-rt-max-width="972px" style="max-width:972px"><div><img src="https://valor-software.com/assets/images/5cac972bf94f986a6fd4a96d_RdepyyO.gif" alt="example gif"></div></figure><p><strong>It happens because of:</strong></p><p>Cypress takes snapshots as your tests run. To see exactly what happened at each step (according to official Cypress documentation), you have to hover over commands in the Command Log.</p><p>The same behavior can be seen on the Applitools screenshots:<strong><br></strong></p><figure class="w-richtext-figure-type-image w-richtext-align-fullwidth" data-rt-type="image" data-rt-align="fullwidth" data-rt-max-width="1816px" style="max-width:1816px"><div><img src="https://valor-software.com/assets/images/5cac976c51b2296b29aec8aa_3WWv2qk.png" alt="image4"></div></figure><h4>Implementation step 2. Making real .png screenshots</h4><p>Instead of snapshots, we decided to make real .png screenshots and save them for later comparison with the reference images. With Cypress it’s easy as 1-2-3:</p><pre><code class="javascript">describe('Charts', () =&gt; {
const componentsArray = [
 {url: '/#LineChart', selector: 'app-line-chart'},
 {url: '/#BarChart', selector: 'app-bar-chart'},
 {url: '/#DoughnutChart', selector: 'app-doughnut-chart'},
 {url: '/#RadarChart', selector: 'app-radar-chart'},
 ];componentsArray.forEach(component =&gt; {
 it(`${component.url}`, () =&gt; {
  cy.visit(component.url);
  cy.get(component.selector).find('canvas').screenshot();
 });
});
});</code></pre><p>We want to compare screenshots of charts only— the rest of the information can be covered by other types of more "stable" UI tests. That's why we need to find the expected &lt;canvas&gt; element and only then take a screenshot. By default, these screenshots will be saved to <em>cypress/screenshots/testName/describeName -- ItName.png</em>. According to our example above, we’ll have four images with unique names.</p><h4>Implementation step 3. Comparing screenshots</h4><p>There are a lot of <a href="https://applitools.com/tutorials" data-rt-link-type="external">Applitools SDKs</a> out there, and the one that suits our needs is "<a href="https://applitools.com/tutorials/selenium-javascript.html" data-rt-link-type="external">Applitools Eyes Javascript SDK</a>." This library provides us with the possibility to compare real images, work with them on the <a href="https://applitools.com/blog/getting-started-with-applitools-eyes-test-manager" data-rt-link-type="external">Applitools Dashboard</a> service without much of a hassle. Everything that is needed from us is to set an API key, choose an appropriate OS and hostingApp, and, of course, provide real images:</p><pre><code class="javascript">var Eyes = require('eyes.images').Eyes;
const fs = require('fs');
const urls = ["#LineChart", "#BarChart", "#DoughnutChart", "#RadarChart"];var eyes = new Eyes();
eyes.setApiKey(YourAPIKey’);
eyes.setHostingApp("Chrome");
eyes.setHostOS('MacOS latest');
async function forEachAsync(array, callback) {
let i = 0;
for (; i &lt; array.length; i++) {
 await callback(array[i], i, array);
}
}const testResults = eyes.open("NG2-charts", "Charts comparison", {width: 1366, height: 768}).then(async function () {
return forEachAsync(urls, async (url) =&gt; {
 const image = fs.readFileSync(`./cypress/screenshots/main-test.js/Charts -- ${url}.png`);
 await eyes.checkImage(image, url);
});
}).then(function () {
return eyes.close();
});testResults.then(function (results) {
console.log("Results: ", results);
});</code></pre><p>That’s it! We’ve achieved our goal in no time and have stable and fully functional tests for quick demo check.</p><h4>Yeah, well, but where's the proof?</h4><p>All needed settings for chosen libraries and all tests can be found in ng2-charts <a href="https://github.com/valor-software/ng2-charts/pull/1072/files" data-rt-link-type="external">Valor Software repo in the appropriate PR</a>.</p><p>If you still don't believe us, here's how Applitools Dashboard looks like:<br></p><figure class="w-richtext-figure-type-image w-richtext-align-fullwidth" data-rt-type="image" data-rt-align="fullwidth" data-rt-max-width="1676px" style="max-width:1676px"><div><img src="https://valor-software.com/assets/images/5cac986cf94f9810c4d4ac0c_nRUcQAt.png" alt="image3"></div></figure><p>...one more thing! Travis CI log, which will be created at each CI test run, can be found on <a href="https://travis-ci.org/valor-software/ng2-charts/builds/507755903?utm_source=github_status&amp;utm_medium=notification" data-rt-link-type="external">Valor Software Travis Dashboard</a>.</p><p><strong>Good news!</strong> According to the <a href="https://applitools.com/" data-rt-link-type="external">Applitools</a> development team, they currently don't support <em>canvas</em> elements in the Cypress plugin. However, they will support them in the future—this will make the whole testing process of <em>canvas</em> elements much easier.</p></div><div class="comments w-embed w-script"><div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = 'https://valor-software.com/articles/testing-canvas-could-be-easier';  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = 'Testing Canvas could be easier'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://valor-software-com.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div><div class="section-sub"><div class="container container__narrow blog__alt"><h2 class="sub__header">Subscribe to find out more</h2><div class="form w-form"><form id="wf-form-Article-s-Subscribe-Form" name="wf-form-Article-s-Subscribe-Form" data-name="Article's Subscribe Form" class="art__form"><input type="email" class="sub__input w-input" maxlength="256" name="Email" data-name="Email" placeholder="Your e-mail" id="Email" required=""><input type="submit" value="Submit" data-wait="Please wait..." class="btn w-button"></form><div class="form__suc-bg w-form-done"><h3 class="sec__suc-2">Thank you!</h3><div> Your submission has been received!</div></div><div class="w-form-fail"><div>Oops! Something went wrong while submitting the form.</div></div></div></div></div><div class="section-art"><div class="container container__narrow"><h2 class="art__heading">More articles</h2><div class="w-dyn-list"><div role="list" class="row w-dyn-items"><div role="listitem" class="col art w-dyn-item"><a href="https://valor-software.com/articles/businessmodels.html" class="blog-card w-inline-block"><div style="background-image:url(&quot;https://valor-software.com/assets/images/5fb294f066bfcd3e42aabeb4_Valor-software-outsourcing-blog-cover.png&quot;)" class="blog-card__img"></div><div class="blog-card__content"><h4 class="blog-card__heading">Why you might want to switch to Time and Material from Fixed Price</h4><div class="blog-card__author"><div style="background-image:url(&quot;https://valor-software.com/assets/images/5fb3cfd99136afe1c0b815c0_evdokimenko.jpeg&quot;)" class="blog-card__author-photo"></div><div><div class="blog-card__author-name">Olga Ievdokymenko</div><div class="blog-card__author-role">Marketing Content Manager</div></div></div></div></a></div><div role="listitem" class="col art w-dyn-item"><a href="https://valor-software.com/articles/cross-site-scripting-xss-a-qa-engineers-guide.html" class="blog-card w-inline-block"><div style="background-image:url(&quot;https://valor-software.com/assets/images/5f69ba3cacb840015aaad117_art-01.jpg&quot;)" class="blog-card__img"></div><div class="blog-card__content"><h4 class="blog-card__heading">Cross-Site Scripting (XSS): a QA Engineer's Guide</h4><div class="blog-card__author"><div style="background-image:url(&quot;https://valor-software.com/assets/images/5f69c242727b7bfd4b24c7d7_moore.jpg&quot;)" class="blog-card__author-photo"></div><div><div class="blog-card__author-name">Sean Moore</div><div class="blog-card__author-role">QA Engineer</div></div></div></div></a></div></div></div></div></div><div class="section-narrow section-narrow--red"><div class="container cta"><div class="cta__wrap"><div class="act__col"><h2 class="cta__header">Feeling inspired?<br></h2><p class="cta__desc">Let's discuss how Valor Software can help with your project's development needs!</p></div><div class="act__col"><a title="go to the contacts page" href="https://valor-software.com/contact.html" class="btn btn--inverted w-button">let's talk</a></div></div></div></div><div class="section-narrow section-narrow--dark"><div class="container"><div class="row footer"><div class="col footer__col"><div class="soc__item"><a rel="noreferrer" href="https://github.com/valor-software" target="_blank" class="w-inline-block"><img src="https://valor-software.com/assets/images/5c4f2b2edfbd6c3b9f281ea9_github.svg" width="40" height="40" alt="github icon"></a></div><div class="soc__item"><a rel="noreferrer" href="https://www.behance.net/ValorSoftware" target="_blank" class="w-inline-block"><img src="https://valor-software.com/assets/images/5c4f2b2edfbd6c9e41281ea8_behance.svg" width="40" height="40" alt="behance icon"></a></div><div class="soc__item"><a rel="noreferrer" href="https://www.facebook.com/valorsoftware/" target="_blank" class="w-inline-block"><img src="https://valor-software.com/assets/images/5c4f2b2ee97f83b6b33d3a3f_facebook.svg" width="40" height="40" alt="facebook icon"></a></div><div class="soc__item"><a rel="noreferrer" href="https://twitter.com/ValorSoft" target="_blank" class="w-inline-block"><img src="https://valor-software.com/assets/images/5c4f2b2ec49ea64ca2b3cee5_twitter.svg" width="40" height="40" alt="twitter icon"></a></div><div class="soc__item"><a rel="noreferrer" href="https://www.linkedin.com/company/valor-software/about/" target="_blank" class="w-inline-block"><img src="https://valor-software.com/assets/images/5c4f2b2ea29a8f6adcf1df87_linkedin.svg" width="40" height="40" alt="linkedin icon"></a></div></div><div class="col footer__col"><p class="footer__copyright">© 2020, Valor Software <br>All Rights Reserved</p></div></div></div></div><script src="https://valor-software.com/assets/js/jquery-3.5.1.min.dc5e7f18c8.js?site=5c3f0ad89f55ca3a4f8c174c" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script src="https://valor-software.com/assets/js/valor.d8b8af848.js" type="text/javascript"></script><!--[if lte IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif]--><!--Prevent zooming on mobile-->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">

</body></html>